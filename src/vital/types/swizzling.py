# This file was auto-generated by Fern from our API Definition.

import datetime as dt
import typing

from ..core.datetime_utils import serialize_datetime
from .period import Period
from .swizzling_bin_granularity import SwizzlingBinGranularity

try:
    import pydantic.v1 as pydantic  # type: ignore
except ImportError:
    import pydantic  # type: ignore


class Swizzling(pydantic.BaseModel):
    """
    The Swizzling mode makes the reducer functions produce statistics
    based on X-of-Y granularity (e.g., day-of-week) for each and every data partition.

    ## Basic usages

    - Hour of Day — gather_every={1, hour}, bin_granularity=day, bin_count=1
    - Day of Week — gather_every={1, day}, bin_granularity=week, bin_count=1
    - Day of Month — gather_every={1, day}, bin_granularity=month, bin_count=1

    ## Output columns

    Swizzling mode adds two additional columns to the output dataframes:

    1. `swizzle_bin`: The bin index of the data point post-binning (with respect to `bin_count`
       and `bin_granularity); and 2 `swizzle_period_start`: The bin-relative period start of the data point with respect to `gather_every`.

    ## Supported combinations

    | gather_every | group_by          |
    | ------------ | ----------------- |
    | minute       | minute, hour, day |
    | hour         | hour, day, week   |
    | day          | day, week, month  |
    | week         | week, month       |
    | month        | month             |
    """

    bin_granularity: SwizzlingBinGranularity
    bin_count: typing.Optional[int]
    gather_every: Period

    def json(self, **kwargs: typing.Any) -> str:
        kwargs_with_defaults: typing.Any = {"by_alias": True, "exclude_unset": True, **kwargs}
        return super().json(**kwargs_with_defaults)

    def dict(self, **kwargs: typing.Any) -> typing.Dict[str, typing.Any]:
        kwargs_with_defaults: typing.Any = {"by_alias": True, "exclude_unset": True, **kwargs}
        return super().dict(**kwargs_with_defaults)

    class Config:
        frozen = True
        smart_union = True
        json_encoders = {dt.datetime: serialize_datetime}
